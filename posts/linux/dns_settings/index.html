<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="本文介绍三个 Linux 上的 DNS 相关的配置文件，分别是/etc/hosts, /etc/resolv.conf 和 /etc/nsswitch.conf 。
1. /etc/hosts /etc/hosts 文件用于本地主机名解析，例如：
127.0.0.1	localhost ::1	localhost ip6-localhost ip6-loopback 该文件最为常见，包含一组 IP 地址和主机名的映射关系。一般当主机名解析时，Linux 会首先在该文件中查找，如果找到对应的主机名，则直接返回对应的 IP 地址，否则才会去 DNS 服务器上查找。
2. /etc/resolv.conf /etc/resolv.conf 文件用于配置 DNS 服务器，其格式如下：
// 本地主机配置 nameserver 192.xxx.xxx.xxx options edns0 search . // k8s 集群环境中的配置 search default.svc.cluster.local svc.cluster.local cluster.local nameserver 10.96.0.10 options ndots:5 nameserver 为配置的域名解析服务器地址，可以为 IPv4 或者 IPv6 地址；
search 指定了一组拓展搜索域；若域名中的 . 少于 options ndots 指定数目，则会以拓展搜索域轮流作为后缀尝试解析，直到得到一个解析结果；若全部拓展域都未匹配则返回报错。
例如：要在 k8s 环境解析应用域名 webserver，则会顺序解析 webserver.default.svc.cluster.local，webserver.svc.cluster.local, webserver."><title>DNS 解析配置文件（On Linux)</title><link rel="shortcut icon" type=image/x-icon href=/><link rel=stylesheet href=/css/main.ebe15b0394daa6798b8a40aa572a71b5a7a1beb8cc02c392f5c142e7d08ddb6052e049639385106440b538f394884685082b7441eef27a6a8315ec723155dc15.css integrity="sha512-6+FbA5TapnmLikCqVypxtaehvrjMAsOS9cFC59CN22BS4Eljk4UQZEC1OPOUiEaFCCt0Qe7yemqDFexyMVXcFQ=="></head><body a=auto><main class=page-content aria-label=Content><div class=w><a href=/>..</a><article><p class=post-meta><time datetime="2023-05-28 14:55:01 +0800 +0800">2023-05-28</time></p><h1>DNS 解析配置文件（On Linux)</h1><p>本文介绍三个 Linux 上的 DNS 相关的配置文件，分别是<code>/etc/hosts</code>, <code>/etc/resolv.conf</code> 和 <code>/etc/nsswitch.conf</code> 。</p><h2 id=1-etchosts>1. /etc/hosts</h2><p><code>/etc/hosts</code> 文件用于本地主机名解析，例如：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>127.0.0.1	localhost
</span></span><span style=display:flex><span>::1		    localhost ip6-localhost ip6-loopback
</span></span></code></pre></div><p>该文件最为常见，包含一组 IP 地址和主机名的映射关系。一般当主机名解析时，Linux 会首先在该文件中查找，如果找到对应的主机名，则直接返回对应的 IP 地址，否则才会去 DNS 服务器上查找。</p><h2 id=2-etcresolvconf>2. /etc/resolv.conf</h2><p><code>/etc/resolv.conf</code> 文件用于配置 DNS 服务器，其格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>// 本地主机配置
</span></span><span style=display:flex><span>nameserver 192.xxx.xxx.xxx
</span></span><span style=display:flex><span>options edns0
</span></span><span style=display:flex><span>search .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>// k8s 集群环境中的配置 
</span></span><span style=display:flex><span>search      default.svc.cluster.local svc.cluster.local cluster.local
</span></span><span style=display:flex><span>nameserver  10.96.0.10
</span></span><span style=display:flex><span>options     ndots:5
</span></span></code></pre></div><p><code>nameserver</code> 为配置的域名解析服务器地址，可以为 IPv4 或者 IPv6 地址；</p><p><code>search</code> 指定了一组拓展搜索域；若域名中的 <code>.</code> 少于 <code>options ndots</code> 指定数目，则会以拓展搜索域轮流作为后缀尝试解析，直到得到一个解析结果；若全部拓展域都未匹配则返回报错。</p><p>例如：要在 k8s 环境解析应用域名 <code>webserver</code>，则会顺序解析 <code>webserver.default.svc.cluster.local</code>，<code>webserver.svc.cluster.local</code>, <code>webserver.cluster.local</code>，直到得到一个解析结果或最终解析失败。</p><p><code>options</code> 为解析器配置项，如: <code>ndots</code>, <code>timeout</code>, <code>attempts</code>, <code>rotate</code>等。</p><p>具体可参见 Linux 的 <a href=https://man7.org/linux/man-pages/man5/resolv.conf.5.html>resolv.conf</a> 文档。</p><h2 id=3-etcnsswitchconf>3. /etc/nsswitch.conf</h2><p><code>/etc/nsswitch.conf</code> 文件用于配置系统的名称解析服务，其中 <code>hosts</code> 专用于域名解析，其格式如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>hosts: files mdns4_minimal dns <span style=color:#f92672>[</span>NOTFOUND<span style=color:#f92672>=</span><span style=color:#66d9ef>return</span><span style=color:#f92672>]</span> myhostname
</span></span></code></pre></div><p><code>files</code> 表示首先在 <code>/etc/hosts</code> 文件中查找；
<code>mdns4_minimal</code> 表示在 mDNS 服务器中查找，mDNS 服务器一般用于局域网中的主机名解析；</p><p><code>dns</code> 表示在 DNS 服务器中查找；<code>[NOTFOUND=return]</code> 表示如果在前面的查找中未找到，则直接返回，不再继续查找；
<code>myhostname</code> 表示以自身主机名作为域名来解析，通常用于解析本地服务。</p><p>因此若任意的解析源得到了解析结果，就不会再继续查找后面的源。例如：若在 <code>/etc/hosts</code> 中找到了对应的 IP 地址，则不会再去后续 DNS 服务器中查找了。</p><h2 id=4-总结>4. 总结</h2><p>本文中，我们了解到三个 Linux 上域名解析相关的配置文件。其中：</p><ul><li><code>/etc/hosts</code> 用于在文件中配置域名到 IP 的解析关系；</li><li><code>/etc/resolv.conf</code> 用于配置域名解析的具体参数，如: 服务器，拓展域等；</li><li><code>/etc/nsswitch.conf</code> 可配置各种名称解析，<code>hosts</code> 可配置域名解析源的相对顺序；</li></ul><p>以上有助于促进对 Linux 上的域名解析机制的了解，更好地帮助我们定位域名解析相关问题。</p><h2 id=5-参考资料>5. 参考资料</h2><ol><li><a href=https://man7.org/linux/man-pages/man5/resolv.conf.5.html>https://man7.org/linux/man-pages/man5/resolv.conf.5.html</a></li><li><a href=https://www.baeldung.com/linux/dns-resolv-conf-file>https://www.baeldung.com/linux/dns-resolv-conf-file</a></li></ol></article></div></main></body></html>